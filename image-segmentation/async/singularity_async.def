Bootstrap: docker
From: pytorch/pytorch:1.7.1-cuda11.0-cudnn8-runtime

%files
    . /workspace/unet3d



%post
    apt-get update && \
    apt-get upgrade -y && \
    apt-get install -y git && \
    apt-get install -y vim && \
    apt-get install -y libmpich-dev libopenmpi-dev  # Add MPI libraries installation

    chmod 777 /etc/ld.so.cache

    pip install --upgrade pip
    pip install torch torchvision torchaudio

    pip install --disable-pip-version-check -r /workspace/unet3d/requirements.txt


%environment
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8

    export PATH=/workspace/unet3d:$PATH

%runscript
    exec /bin/bash "$@"