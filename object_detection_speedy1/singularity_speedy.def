 
Bootstrap: docker
From: pytorch/pytorch:1.10.0-cuda11.3-cudnn8-devel

%files
    . /workspace/object_detection

%post

echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections
apt-key adv --fetch-keys https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/3bf863cc.pub

# install basics
apt-get update -y \
 && apt-get install -y apt-utils \
                       libglib2.0-0=2.56.1-2ubuntu1 \
                       libsm6=2:1.2.2-1 \
                       libxext6=2:1.3.3-1 \
                       libxrender-dev=1:0.9.10-1

pip install ninja==1.8.2.post2 \
                yacs==0.1.5 \
                cython==0.29.5 \
                matplotlib==3.0.2 \
                opencv-python==4.0.0.21 \
                mlperf_compliance==0.0.10 \
                torchvision==0.2.2 \
                pycocotools==2.0.2

pip install --no-cache-dir https://github.com/mlperf/logging/archive/9ea0afa.zip


cd pytorch \
 && rm -rf build/
# && python setup.py clean build develop --user

apt install -y vim
apt install -y time


    chmod 777 /etc/ld.so.cache

%environment
    export LC_ALL=C.UTF-8
    export LANG=C.UTF-8

    export PATH=/workspace/object_detection:$PATH

%runscript
    exec /bin/bash "$@"